<!doctype html>
<html>
<head>
  <title>This is the title of the webpage!</title>
</head>

<style>
#loading {
    width: 2rem;
    height: 2rem;
    border: 5px solid #f3f3f3;
    border-top: 6px solid #9c41f2;
    border-radius: 100%;
    margin: auto;
    visibility: hidden;
    animation: spin 1s infinite linear;
}
#loading.display {
    visibility: visible;
}
@keyframes spin {
    from {
        transform: rotate(0deg);
    }
    to {
        transform: rotate(360deg);
    }
}
</style>

<body style="background-color:#1B1B1B" text="#f0f8ff">


<p>Paste the beatmap ids and click to download mappack.</p>

<label for="inputbox">Beatmap IDs:</label>
<input type="text" id="inputbox" name="fname">
<button id="button">Get Mappack!</button>
<div id="loading"></div>
<script>
    var button = document.getElementById("button");
    const loader = document.querySelector("#loading");

    function displayLoading() {
        loader.classList.add("display");
        // to stop loading after some time
        setTimeout(() => {
            loader.classList.remove("display");
        }, 60000);
    }


    // hiding loading
    function hideLoading() {
        loader.classList.remove("display");
    }

    function displayError() {

    }

    button.onclick = function () {
        displayLoading()
        let value = document.getElementById("inputbox").value;
        console.log(`Value is: ${value}`)
        fetch(`/api/make_pool?beatmaps=${value}`, {
            method: "GET",
            headers: {'Content-Type': 'application/json'}
        }).then(res => {
                hideLoading()
                if (res.ok) {
                    return res.blob()
                } else {
                    displayError(`${res.json()}`);
                }
            }
        ).then(blob => {
            var file = window.URL.createObjectURL(blob);
            window.location.assign(file);
            console.log("Request complete! response:", res);
        }).catch((error) => {
            console.log(error)
        });
    };

</script>
</body>
</html>